<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title>Gamedev Canvas Workshop</title>
    <style>
    	* { padding: 0; margin: 0; }
    	canvas { background: #eee; display: block; margin: 0 auto; }
    </style>
</head>
<body>
<canvas id="myCanvas" width="480" height="320"></canvas>

<script>
	var title = "Break Out!";
	var byLine = "By: Nate Baker"
	var pause = "Paused"
	var gameOver = "Game over!"
	var newLevel = "Level: 1"
	var pressEnter = "Press enter to continue"
	var canvas = document.getElementById("myCanvas");
	var ctx = canvas.getContext("2d");
	var ballX = canvas.width/2;
	var ballY = canvas.height/2;
	var ballDirX = 2;
	var ballDirY = 2;
	var ballRadius = 10;
	var paddleWidth = 75
	var paddleHeight = 10;
	var paddleX = (canvas.width - paddleWidth)/2;
	var rightPressed = false;
	var leftPressed = false;
	var paddleSpeed = 7;
	var bricks;
	var brickRowCount = 3;
	var brickColumnCount = 5;
	var brickWidth = 75;
	var brickHeight = 20;
	var brickPadding = 10;
	var brickOffsetTop = 30;
	var brickOffsetLeft = 30;
	var score = 0;
	var level = 1;
	var lives = 3;
	var bricksCreated = 0;
	var gameStatus = {
		START: 1,
		GAMEOVER: 2,
		PAUSED: 3,
		PLAY: 4,
		VICTORY: 5,
		NEWLIFE: 6,
	}
	var gameState = gameStatus.START;
	var blueGem = new Image();
	blueGem.src = "images/blueGem.png"
	var redGem = new Image();
	blueGem.src = "images/redGem.png"
	var greeGem = new Image();
	blueGem.src = "images/greenGem.png"
	var whiteGem = new Image();
	blueGem.src = "images/whiteGem.png"
	
	var powerUps = [];
	
	document.addEventListener("keydown", keyDownHandler, false);
	document.addEventListener("keyup", keyUpHandler, false);
	document.addEventListener("keypress", keyPressHandler);
	
	gameStart();
	
	function gameStart (){
		console.log("Game start: "+gameState);
		if(gameState != gameStatus.NEWLIFE){	
			console.log("Balls");
			bricks = [];		
			for(c = 0; c < brickColumnCount; c++){
				bricks[c] = [];
			
				for(r = 0; r < brickRowCount; r++){
					var brickX = (c*(brickWidth+brickPadding))+brickOffsetLeft;
					var brickY = (r*(brickHeight+brickPadding))+brickOffsetTop;
					bricks[c][r] = {x: brickX, y: brickY, color: getRandomColor(), status: 1};
				}
			}
			bricksCreated = brickRowCount*brickColumnCount;
		}
		
		ballX = canvas.width/2;
		ballY = canvas.height/2;
		paddleX = (canvas.width - paddleWidth)/2;
		ballDirX = 2;
		ballDirY = 2;
		if(gameState == gameStatus.GAMEOVER){
			console.log("Game over restart");
			level = 0;
			score = 0;
			lives = 3;
			gameState = gameStatus.START;
		}
	}
	
	
	function  keyDownHandler(e){
		if(e.keyCode == 39){
			rightPressed = true;
		}
		else if(e.keyCode == 37){
			leftPressed = true;
		}
	}

	function keyUpHandler(e){
		if(e.keyCode == 39){
			rightPressed = false;
		}
		else if(e.keyCode == 37){
			leftPressed = false;
		}
	}
	function keyPressHandler(e){
		if(e.keyCode == 13){
			if(gameState == gameStatus.START || gameState == gameStatus.PAUSED ||
			gameState == gameStatus.VICTORY || gameState == gameStatus.NEWLIFE){
				gameState = gameStatus.PLAY
			}
			else if(gameState == gameStatus.GAMEOVER){
				gameStart();
			}
			else{
				gameState = gameStatus.PAUSED;
			}
		}
	}
		
	function drawBall(){
		ctx.beginPath()
		ctx.arc(ballX, ballY, ballRadius, 0, Math.PI*2);
		ctx.fillStyle = "#0095DD"
		ctx.fill();
		ctx.closePath();
	}
	function drawPaddle(){
		ctx.beginPath();
		ctx.rect(paddleX, canvas.height - paddleHeight, paddleWidth, paddleHeight);
		ctx.fillStyle = "0095DD";
		ctx.fill();
		ctx.closePath;
	}
	function drawBricks(){
		for(c = 0; c < brickColumnCount; c++){
			for(r = 0; r < brickRowCount; r++){
				if(bricks[c][r].status == 1){
					ctx.beginPath();
					ctx.rect(bricks[c][r].x, bricks[c][r].y, brickWidth, brickHeight);
					ctx.fillStyle = bricks[c][r].color;
					ctx.fill();
					ctx.closePath();
				}
			}
		}
	}
	function createPowerUps(xStart, yStart){
		console.log("power up created")
		var chance = Math.random()*100;
		console.log(chance)
		if(chance == 0){
			powerUps[powerUps.lenght+1] = {image: whiteGem, score: 100, oneUp: 1, x: xStart, y: yStart}
		}
		else if(chance <= 0 && chance > 10){
			powerUps[powerUps.lenght+1] = {image: redGem, score: 100, oneUp: 0, x: xStart, y: yStart}
		}
		else if(chance <= 10 && chance > 15){
			powerUps[powerUps.lenght+1] = {image: blueGem, score: 100, oneUp: 0, x: xStart, y: yStart}
		}
		else if(chance <= 15 && chance > 25){
			powerUps[powerUps.lenght+1] = {image: greenGem, score: 100, oneUp: 0, x: xStart, y: yStart}
		}
	}
	function drawPowerUps(){
		for(var i = powerUps.lenght; i > 0; i++){
			ctx.drawImage(powerUps[i].image, powerUps.x, powerUps.y);
		}
	}
	function drawScore(){
		ctx.font = "16px Arial";
		ctx.fillStyle = "#0095DD";
		ctx.fillText("Score: "+score, 8, 20);
		ctx.fillText("Lives: "+lives, canvas.width-64, 20);
	}
	function drawTitles(){
		if(gameState == gameStatus.START){
			ctx.font = "46px Arial";
			ctx.fillStyle = "#0095DD";
			ctx.fillText(title, canvas.width/2- ctx.measureText(title).width/2, canvas.height/2);
			ctx.font = "16px Arial";
			ctx.fillText(byLine, canvas.width/2- ctx.measureText(byLine).width/2, canvas.height/2+18);
			ctx.fillText(pressEnter, canvas.width/2- ctx.measureText(pressEnter).width/2, canvas.height/2+34);
		}
		else if(gameState == gameStatus.GAMEOVER){
			ctx.font = "46px Arial";
			ctx.fillStyle = "#0095DD";
			ctx.fillText(gameOver, canvas.width/2- ctx.measureText(gameOver).width/2, canvas.height/2);
			ctx.font = "16px Arial";
			ctx.fillStyle = "#0095DD";
			ctx.fillText(pressEnter, canvas.width/2- ctx.measureText(pressEnter).width/2, canvas.height/2+16);
		}
		else if(gameState == gameStatus.PAUSED){
			ctx.font = "46px Arial";
			ctx.fillStyle = "#0095DD";
			ctx.fillText(pause, canvas.width/2- ctx.measureText(pause).width/2, canvas.height/2);
			ctx.font = "16px Arial";
			ctx.fillStyle = "#0095DD";
			ctx.fillText(pressEnter, canvas.width/2- ctx.measureText(pressEnter).width/2, canvas.height/2+16);
		}
		else if(gameState == gameStatus.VICTORY){
			newLevel = "Level: "+level+"";
			ctx.font = "46px Arial";
			ctx.fillStyle = "#0095DD";
			ctx.fillText(level, canvas.width/2- ctx.measureText(level).width/2, canvas.height/2);
			ctx.font = "16px Arial";
			ctx.fillStyle = "#0095DD";
			ctx.fillText(pressEnter, canvas.width/2- ctx.measureText(pressEnter).width/2, canvas.height/2+16);
		}
		else if(gameState == gameStatus.NEWLIFE){
			newLevel = "Level: "+level+" Lives: "+lives;
			ctx.font = "46px Arial";
			ctx.fillStyle = "#0095DD";
			ctx.fillText(level, canvas.width/2- ctx.measureText(level).width/2, canvas.height/2);
			ctx.font = "16px Arial";
			ctx.fillStyle = "#0095DD";
			ctx.fillText(pressEnter, canvas.width/2- ctx.measureText(pressEnter).width/2, canvas.height/2+16);
		}
	}
	function getRandomColor() {
		var letters = '0123456789ABCDEF'.split('');
		var color = '#';
		for (var i = 0; i < 6; i++ ) {
			color += letters[Math.floor(Math.random() * 16)];
		}
		return color;
	}
	function randomIntFromInterval(min,max)
	{
		return Math.floor(Math.random()*(max-min+1)+min);
	}
	function collisionDetection() {
		for(c=0; c<brickColumnCount; c++) {
			for(r=0; r<brickRowCount; r++) {
				var b = bricks[c][r];
				if(b.status == 1){
					if(ballX > b.x && ballX < b.x+brickWidth && ballY > b.y && ballY < b.y+brickHeight) {
						ballDirY = -ballDirY;
						b.status = 0;
						score += 10;
						bricksCreated--;
						createPowerUps();
						if(bricksCreated <= 0) {
							gameState = gameStatus.VICTORY;
							level++;
							gameStart();
						}
					}
				}
			}
        }
		
    }
	function draw(){
//Begin logic
		if(gameState == gameStatus.PLAY){
			ballX += ballDirX;
			ballY += ballDirY;
//Ball movement
			if(ballX+ballDirX < 0 || ballX + ballDirX > canvas.width - ballRadius){
				ballDirX = -ballDirX;
			}
			if(ballY+ballDirY < 0){
				ballDirY = -ballDirY;
			}
			else if(ballY + ballDirY > canvas.height - ballRadius){
				if(ballX > paddleX && ballX < paddleX + paddleWidth){
					ballDirY = -ballDirY;
					ballDirX = randomIntFromInterval(-4, 3);
				}
				else{
					if(lives > 0){
						gameState = gameStatus.NEWLIFE;
						lives--;
						gameStart();
					}
					else{
						gameState = gameStatus.GAMEOVER;
					}
				}
			}
//Paddel movement
			if(rightPressed && paddleX < canvas.width-paddleWidth) {
				paddleX += paddleSpeed;
			}
			else if(leftPressed && paddleX > 0) {
				paddleX -= paddleSpeed;
			}
//collisionDetection
			collisionDetection();
		}
//Begin render
		ctx.clearRect(0, 0, canvas.width, canvas.height);
//Draw Sprites
		if(gameState == gameStatus.PLAY){
			drawBall();
		}
		drawPaddle();
		drawBricks();
		
		drawScore();
		drawTitles();
	}
	setInterval(draw, 10);
</script>

</body>
</html>
